window.__require=function t(n,e,s){function i(o,a){if(!e[o]){if(!n[o]){var c=o.split("/");if(c=c[c.length-1],!n[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+o+"'")}o=c}var l=e[o]={exports:{}};n[o][0].call(l.exports,function(t){return i(n[o][1][t]||t)},l,l.exports,t,n,e,s)}return e[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<s.length;o++)i(s[o]);return i}({Control:[function(t,n,e){"use strict";cc._RF.push(n,"eda12RVrGJD3a1qK6Lerryu","Control"),cc.Class({extends:cc.Component,properties:{net:{default:null,type:cc.Node}},onLoad:function(){var t=function(t){var n=this.net.getComponent("net"),e=t.getLocation();n.startrun(e)};this.node.on("touchstart",t.bind(this));var n=function(t){this.net.getComponent("net").stoprun()};this.node.on("touchend",n.bind(this)),this.node.on("touchcancel",n.bind(this)),this.node.on("touchmove",t.bind(this))},start:function(){}}),cc._RF.pop()},{}],"NaiveNetClient-mini.2.0.1.dev":[function(t,n,e){"use strict";cc._RF.push(n,"44b33mCUYRFLK9hnTnJRtZ2","NaiveNetClient-mini.2.0.1.dev"),e.__esModule=!0,e.default=void 0;var s=new(function(){function t(){}return t.prototype.callback=function(t){t.success=t.success||function(){},t.fail=t.fail||function(){},t.complete=t.complete||function(){},t._success=function(n){t.success(n),t.complete(n)},t._fail=function(n){t.fail(n),t.complete(n)}},t}()),i={200:"ok",400:"not found controller",401:"not found channel",402:"cannot be established",403:"channel refuse connect",404:"channel not established with server",500:"permission denied",501:"data format error",502:"unknow error",503:"recover failed"},r=null;function o(t){return r?{data:t}:t}"undefined"!=typeof wx?r=wx:"undefined"!=typeof tt&&(r=tt);var a=function(){function t(){this._ctrls={}}var n=t.prototype;return n.addController=function(t,n){void 0===n&&(n=function(t,n){void 0===n&&(n=function(){})}),this._ctrls[t]=n},n.removeController=function(t){this._ctrls[t]&&(this._ctrls[t]=null)},n._do=function(t,n){return void 0===n&&(n=function(){}),!!this._ctrls[t.controller]&&(this._ctrls[t.controller](t,n),!0)},t}(),c=function(){function t(t){void 0===t&&(t=!0),this._sockettask=null,this._level=0,this._autocode=t,this._t_msg=[],this._t_wt=[],this._timeout=5e3,this._ping=0,this._hearttimeout=1e4,this._auth=!1,this._sessionid="",this._ns="",this._channel={},this._channel_cache={},this._boxs=[],this.onBreak=function(){},this.onRecover=function(){},this.onAuth=function(){},this.onPingChange=function(){},this._donotcallOnbreak=!1}var n=t.prototype;return n.setToken=function(t){this._sessionid=t},n.getToken=function(){return this._auth?this._sessionid:null},n.connect=function(t){if(t=t||{},s.callback(t),this.close(),r)this._sockettask=r.connectSocket({url:t.ns,success:function(t){},fail:function(n){t._fail({code:400,errmsg:"\u65e0\u6cd5\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5"})}}),this._sockettask.onOpen(function(){this._level=1,this._ns=t.ns,t._success({code:200,errmsg:"\u6210\u529f\u5efa\u7acb\u8fde\u63a5"}),this._autoheart()}.bind(this)),this._sockettask.onClose(function(t){this._level=0,this._onBreak()}.bind(this)),this._sockettask.onMessage(function(t){this._parseMsg(t)}.bind(this)),this._sockettask.onError(function(n){this.level=0,t._fail({code:400,errmsg:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25"})}.bind(this));else{if(this._sockettask=new WebSocket(t.ns),this._sockettask.binaryType="arraybuffer",!this._sockettask)return void t._fail({code:400,errmsg:"\u8fde\u63a5\u5931\u8d25"});this._sockettask.onopen=function(){this._level=1,this._ns=t.ns,t._success({code:200,errmsg:"\u6210\u529f\u5efa\u7acb\u8fde\u63a5"}),this._autoheart()}.bind(this),this._sockettask.onclose=function(t){this._level=0,this._onBreak()}.bind(this),this._sockettask.onmessage=function(t){this._parseMsg(t)}.bind(this),this._sockettask.onerror=function(n){t._fail({code:400,errmsg:"\u8fde\u63a5\u5931\u8d25"})}.bind(this)}},n.close=function(t){var n=this;t=t||{},s.callback(t),this._sockettask?this.request({controller:"close",complete:function(e){n._sockettask.close(),n._level=0,t._success({code:200})}}):t._success({code:200})},n.break=function(t){t=t||{},s.callback(t),1==this._level&&(this._level=0,void 0===t.eventstatus&&(t.eventstatus=!0),t.eventstatus?this._donotcallOnbreak=!1:this._donotcallOnbreak=!0,this._sockettask.close())},n.recover=function(t){var n=this;t=t||{},s.callback(t),t.token=t.token||this._sessionid,t.ns=t.ns||this._ns,1!=this._level?this.connect({ns:t.ns,success:function(e){n.request({channel:"",controller:"recover",data:t.token,success:function(e){n._level=1,t._success(e),n.onRecover()},fail:function(e){n.break({eventstatus:!1}),t._fail(e)}})},fail:function(n){t._fail(n)}}):t._success({code:200,errmsg:"ok"})},n.enterChannel=function(t){var n=this;if(t=t||{},s.callback(t),""!=t.channel){var e=this._ns+"_"+t.channel;if(t.cache)if(this._channel_cache[e])return void t._success({code:200,errmsg:"ok use cache"});this.request({channel:"",controller:"enterChannel",data:t.channel,success:function(s){n._channel_cache[e]=!0,t._success({code:200,errmsg:"ok no cache"})},fail:function(n){t._fail(n)}})}else t._success({code:200,errmsg:"ok connect ns"})},n.quitChannel=function(t){var n=this;t=t||{},s.callback(t),this.getChannelID({channel:t.channel,success:function(e){n.request({channel:"",controller:"quitChannel",data:e.id+"",complete:function(n){t._success({code:200,errmsg:"ok"})}})}})},n.getChannelID=function(t){var n=this;if(t=t||{},s.callback(t),t.channel=t.channel||"",""!=t.channel){var e=this._channel[this._ns];e||(this._channel[this._ns]={},e={});var i=e[t.channel];i?t._success({code:200,id:i}):this.request({channel:"",controller:"getChannel",data:t.channel,success:function(e){if(200==e.code){var s=parseInt(e.data);return n._channel[n._ns][t.channel]=s,void t._success({code:200,id:s})}t._fail({code:400,errmsg:"\u83b7\u53d6\u5931\u8d25"})},fail:function(n){t._fail(n)}})}else t._success({code:200,id:0})},n.request=function(t){var n=this;t=t||{},s.callback(t),t.channel=t.channel||"",t.data=t.data||"",t.controller?1==this._level?this.getChannelID({channel:t.channel,success:function(e){n.enterChannel({channel:t.channel,cache:!0,success:function(s){var i=!1,r={channelid:e.id,data:t.data,controller:t.controller,success:function(n){t._success(n)},fail:function(e){if(404==e.code){if(i)return void t._fail(e);i=!0,n.enterChannel({channel:t.channel,cache:!1,success:function(t){n._request(r)},fail:function(n){t._fail(n)}})}else t._fail(e)}};n._request(r)},fail:function(n){t._fail(n)}})},fail:function(n){t._fail(n)}}):t._fail({code:400,errmsg:"\u5f53\u524d\u72b6\u6001\u65e0\u6cd5\u53d1\u51fa\u8bf7\u6c42"}):t._fail({code:400,errmsg:"\u63a7\u5236\u5668\uff08controller\uff09\u4e0d\u80fd\u4e3a\u7a7a"})},n.createBox=function(){return new a},n.addBox=function(t){for(var n=0;n<this._boxs.length;n++)if(this._boxs[n]==t)return;this._boxs.push(t)},n.removeBox=function(t){for(var n=0;n<this._boxs.length;n++)if(this._boxs[n]==t){for(var e=n+1;e<this._boxs.length;e++)this._boxs[e-1]=this._boxs[e];return this._boxs.pop(),!0}return!1},n._request=function(t,n){t=t||{},s.callback(t);var e=t.channelid,i=-1;if(this._t_msg.length<255)this._t_msg.push({}),i=this._t_msg.length-1;else for(var r=0;r<255;r++)if(this._t_msg[r][1]){i=r;break}if(-1!=i){var a=[t,!1,-1,(new Date).getTime()];this._t_msg[i]=a;var c=t.data||"";"string"==typeof c&&(c=this._stringToArrayBuffer(c));var h=this._genLenArrayBuffer(e),l=this._stringToArrayBuffer(t.controller),u=new Uint8Array(l),f=this._genLenArrayBuffer(u.length),_=this._stringToArrayBuffer(t.data),d=new Uint8Array(_),g=this._genLenArrayBuffer(d.length),v=new ArrayBuffer(h.length+u.length+f.length+d.length+g.length+2),p=new Uint8Array(v);p[0]=1,p[1]=i,p.set(h,2);var b=2+h.length;p.set(f,b),b+=f.length,p.set(u,b),b+=u.length,p.set(g,b),b+=g.length,p.set(d,b);try{this._sockettask.send(o(p.buffer)),this._t_msg[i][2]=setTimeout(function(){t._fail({code:401,errmsg:"\u54cd\u5e94\u8d85\u65f6"}),this._t_msg[i][1]=!0,this._sendCheckWt()}.bind(this),this._timeout)}catch(n){t._fail({code:400,errmsg:"\u53d1\u9001\u5931\u8d25"}),this._t_msg[i][1]=!0,this._sendCheckWt()}}else this._t_wt.push(t)},n._autoheart=function(){(function t(){1==this._level&&(this.request({controller:"heart",data:""+this._ping}),setTimeout(t.bind(this),this._hearttimeout))}).bind(this)()},n._onBreak=function(){this._donotcallOnbreak||this.onBreak({code:400,errmsg:"break"}),this._donotcallOnbreak=!1},n._parseMsg=function(t){var n=new Uint8Array(t.data);if(0!=n[0]&&3!=n[0]){if(1==n[0]){n[0];var e=n[1],s=2,r=this._parseLenArrayBuffer(s,n),o=r[1],a=(s+=r[0])-1,c=this._parseLenArrayBuffer(s,n);s+=c[0];var h=this._parseContentArrayBuffer(s,n,c[1]);s+=c[1];var l=this._parseLenArrayBuffer(s,n);s+=l[0];var u=this._parseContentArrayBuffer(s,n,l[1]);0==o?this._dealNSToClient(this.Uint8ArrayToString(h),this.Uint8ArrayToString(u)):this._dealNCToClient({originContent:n,originHeaderEndIndex:a,originMsgID:e,originChannelID:o,controller:this.Uint8ArrayToString(h),dataBytes:u,data:this._autocode?this.Uint8ArrayToString(u):null})}}else{var f=n[1],_=this._t_msg[f];if(_[1])return;var d=2,g=this._parseLenArrayBuffer(d,n);g[1];d+=g[0];var v=this._parseLenArrayBuffer(d,n);d+=v[0];var p=this._parseContentArrayBuffer(d,n,v[1]),b=(new Date).getTime()-_[3];if(this._setPing(b),_[1]=!0,clearTimeout(_[2]),0==n[0])_[0]._success({code:200,originData:p,data:this._autocode?this.Uint8ArrayToString(p):null,errmsg:i[200]});else{var k=parseInt(this.Uint8ArrayToString(p));_[0]._fail({code:k,errmsg:i[k]})}this._sendCheckWt()}},n._dealNSToClient=function(t,n){switch(t){case"auth":this._auth=!0,this._sessionid=n,this.onAuth({code:200,errmsg:"ok",token:n})}},n._dealNCToClient=function(t){var n=this,e=function(e){void 0===e&&(e=""),n._response(t,!0,e)};for(var s in this._boxs){if(this._boxs[s]._do(t,e))return}this._response(t,!1,null)},n._response=function(t,n,e){void 0===e&&(e=null);for(var s="string"==typeof e?this._stringToArrayBuffer(e):e,i=new Uint8Array(s),r=this._genLenArrayBuffer(i.length),a=new ArrayBuffer(t.originHeaderEndIndex+1+r.length+i.length),c=new Uint8Array(a),h=0;h<=t.originHeaderEndIndex;h++)c[h]=t.originContent[h];c[0]=n?0:3;var l=t.originHeaderEndIndex+1;c.set(r,l),l+=r.length,c.set(i,l),this._sockettask.send(o(c.buffer))},n._sendCheckWt=function(){if(this._t_wt.length>0){var t=this._t_wt.shift();this.request(t)}},n._setPing=function(t){this._ping=parseInt(t/2),this.onPingChange(this._ping)},n.getPing=function(){return this._ping},n._parseLenArrayBuffer=function(t,n){for(var e=0,s=0,i=t;i<n.length;i++){var r=n[i];if(255!=r)return[1,r];e+=r,s++}return new[s,e]},n._parseContentArrayBuffer=function(t,n,e){for(var s=[],i=t,r=0;r<e;i++)s.push(n[i]),r+=1;return new Uint8Array(s)},n._genLenArrayBuffer=function(t){for(var n=parseInt(t/255)+1,e=new ArrayBuffer(n),s=new Uint8Array(e),i=0;i<n;i++){if(!(t>255)){s[i]=t;break}s=255,t-=255}return s},n._stringToArrayBuffer=function(t){var n,e,s=new Array;n=t.length;for(var i=0;i<n;i++)(e=t.charCodeAt(i))>=65536&&e<=1114111?(s.push(e>>18&7|240),s.push(e>>12&63|128),s.push(e>>6&63|128),s.push(63&e|128)):e>=2048&&e<=65535?(s.push(e>>12&15|224),s.push(e>>6&63|128),s.push(63&e|128)):e>=128&&e<=2047?(s.push(e>>6&31|192),s.push(63&e|128)):s.push(255&e);var r=new Int8Array(s.length);for(var i in s)r[i]=s[i];return r.buffer},n._arrayBufferToString=function(t){if("string"==typeof t)return t;for(var n=new DataView(t.data),e=new Uint8Array(t.data.byteLength),s=0;s<e.length;s++)e[s]=n.getUint8(s);var i="",r=t=e;for(s=0;s<r.length;s++){var o=r[s].toString(2),a=o.match(/^1+?(?=0)/);if(a&&8==o.length){for(var c=a[0].length,h=r[s].toString(2).slice(7-c),l=1;l<c;l++)h+=r[l+s].toString(2).slice(2);i+=String.fromCharCode(parseInt(h,2)),s+=c-1}else i+=String.fromCharCode(r[s])}return i},n.Uint8ArrayToString=function(t){var n,e,s,i,r,o;for(n="",s=t.length,e=0;e<s;)switch((i=t[e++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=t[e++],n+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=t[e++],o=t[e++],n+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&o)<<0)}return n},t}();e.default=c,n.exports=e.default,cc._RF.pop()},{}],net:[function(t,n,e){"use strict";cc._RF.push(n,"bf409XF5z1BYZe/0cmCkn/t","net");var s=new(t("NaiveNetClient-mini.2.0.1.dev")),i=[cc.color(153,235,73),cc.color(235,229,73),cc.color(79,181,239),cc.color(244,126,215),cc.color(131,146,184),cc.color(134,242,162),cc.color(227,251,176)];cc.Class({extends:cc.Component,properties:{canvas:{type:cc.Node,default:null},ping:{type:cc.Label,default:null},ctx:null,x_b:0,y_b:0,line_w:50,running:!1,a:0,step:1,Label:{type:cc.Label,default:null},id:0,uploading:!1,needUpload:!1,data:[]},onLoad:function(){var t=this;this.ctx=this.node.getComponent(cc.Graphics),this.ctx.lineWidth=1.5,this.ctx.strokeColor=cc.color(132,252,237,204),console.log(this.Label),this.Label.string="\u6b63\u5728\u5c1d\u8bd5\u5efa\u7acb\u8fde\u63a5";var n=s.createBox();n.addController("updatedata",function(t,n){n();var e=t.data,s=JSON.parse(e);this.data=s}.bind(this)),s.addBox(n),s.onBreak=function(){}.bind(this),s.connect({ns:"ws://ns01.domoe.cn:1000",success:function(n){t.Label.string="\u5efa\u7acb\u6210\u529f\uff0c\u6b63\u5728\u7533\u8bf7\u6388\u6743",s.request({channel:"auth",controller:"auth",data:"ballbattle",success:function(n){console.log(n),(n.data="ok")?(t.Label.string="\u6b63\u5728\u8bbf\u95ee\u5b9e\u65f6\u8d44\u6e90...",s.request({channel:"play",controller:"enter",success:function(n){console.log(n),"full"!=n.data?(t.Label.string="#"+n.data,t.id=n.data):t.Label.string="\u8bf7\u6c42\u7528\u6237\u8fc7\u591a\uff0c\u65e0\u6cd5\u63a7\u5236\u5c0f\u7403"},fail:function(n){console.log(n),t.Label.string="\u8bbf\u95ee\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",s.close()}})):(t.Label.string="\u7533\u8bf7\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",s.close())},fail:function(n){t.Label.string="\u7533\u8bf7\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",s.close()}})},fail:function(n){t.Label.string="\u8fde\u63a5\u5efa\u7acb\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"}}),s.onPingChange=function(t){this.ping.string="ping:"+t+"ms"}.bind(this)},start:function(){this.drawNet(),this.drawBall()},update:function(t){this.drawNet(),this.drawBall(),this.drawOthersBall()},drawOthersBall:function(){},drawNet:function(){this.ctx.clear();for(var t=this.canvas.width/2,n=this.canvas.height/2,e=-1*n+this.y_b%this.line_w;e<n;e+=this.line_w)this.ctx.moveTo(-t,e),this.ctx.lineTo(t,e);for(var s=-1*t+this.x_b%this.line_w;s<t;s+=this.line_w)this.ctx.moveTo(s,-n),this.ctx.lineTo(s,n);this.ctx.stroke()},drawBall:function(){for(var t in this.data)this.ctx.fillColor=i[parseInt(this.data[t].id)%i.length],this.ctx.circle(-(this.data[t].x-this.x_b),-(this.data[t].y-this.y_b),70),this.ctx.fill(),this.ctx.stroke()},startrun:function(t){if(null!=this.id){var n=[this.canvas.width/2,this.canvas.height/2],e=t.x-n[0],s=t.y-n[1],i=0,r=e/Math.sqrt(e*e+s*s);i=Math.acos(r),s<0&&(i*=-1),this.a=i;this.running||(this.running=!0,function t(){this.x_b-=Math.cos(this.a)*this.step,this.y_b-=Math.sin(this.a)*this.step,this.x_b<-5e3&&(this.x_b=-5e3),this.x_b>5e3&&(this.x_b=5e3),this.y_b>5e3&&(this.y_b=5e3),this.y_b<-5e3&&(this.y_b=-5e3),this.needUpload=!0,this.upload(),this.update(),this.running&&setTimeout(t.bind(this),1e3/60)}.bind(this)())}},stoprun:function(){this.running=!1},upload:function(){var t=this;this.uploading||(this.uploading=!0,this.needUpload=!1,s.request({channel:"play",controller:"move",data:JSON.stringify({x:parseInt(this.x_b),y:parseInt(this.y_b)}),complete:function(n){t.uploading=!1,t.needUpload&&t.upload()}}))}}),cc._RF.pop()},{"NaiveNetClient-mini.2.0.1.dev":"NaiveNetClient-mini.2.0.1.dev"}]},{},["Control","NaiveNetClient-mini.2.0.1.dev","net"]);
//# sourceMappingURL=index.js.map
